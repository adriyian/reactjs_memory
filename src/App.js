import React, { Component } from "react";
import shuffle from "lodash.shuffle";

import "./App.css";

import Card from "./Card";
import GuessCount from "./GuessCount";
import HallOfFame, { FAKE_HOF } from "./HallOfFame";

const VIUAL_PAUSE_MSEC = 750;
const SIDE = 6;

const SYMBOLS = [ "ðŸ˜","ðŸ˜‚","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‰","ðŸ˜Š","ðŸ˜‹","ðŸ˜Ž","ðŸ˜","ðŸ˜˜","ðŸ˜š","ðŸ˜","ðŸ˜¶","ðŸ˜","ðŸ˜£","ðŸ˜¥","ðŸ˜ª","ðŸ˜«","ðŸ˜Œ","ðŸ˜œ","ðŸ˜","ðŸ˜’","ðŸ˜“","ðŸ˜”","ðŸ˜²","ðŸ˜–","ðŸ˜ž","ðŸ˜¤","ðŸ˜¢","ðŸ˜­","ðŸ˜¨","ðŸ˜©","ðŸ˜°","ðŸ˜±","ðŸ˜³","ðŸ˜µ","ðŸ˜¡","ðŸ˜ ","ðŸ˜·","ðŸ˜‡","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ’€","ðŸ‘»","ðŸ‘½","ðŸ‘¾","ðŸ’©","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ‘¶","ðŸ‘¦","ðŸ‘§","ðŸ‘¨","ðŸ‘©","ðŸ‘´","ðŸ‘µ","ðŸ‘®","ðŸ’‚","ðŸ‘·","ðŸ‘¸","ðŸ‘³","ðŸ‘²","ðŸ‘±","ðŸ‘°","ðŸ‘¼","ðŸŽ…","ðŸ™","ðŸ™Ž","ðŸ™…","ðŸ™†","ðŸ’","ðŸ™‹","ðŸ™‡","ðŸ’†","ðŸ’‡","ðŸš¶ ","ðŸƒ","ðŸ’ƒ","ðŸ‘¯","ðŸ›€","ðŸ‘¤","ðŸ‘¥","ðŸ‡","ðŸ‚","ðŸ„","ðŸš£","ðŸŠ","ðŸš´","ðŸšµ","ðŸ‘«","ðŸ‘¬","ðŸ‘­","ðŸ’","ðŸ’‘","ðŸ‘ª","ðŸ’ª","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ‘‡","âœ‹","ðŸ‘Œ","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ‘‹","ðŸ‘","ðŸ‘","ðŸ™Œ","ðŸ™","ðŸ’…","ðŸ‘‚","ðŸ‘ƒ","ðŸ‘£","ðŸ‘€","ðŸ‘…","ðŸ‘„","ðŸ’‹","ðŸ’˜","ðŸ’“","ðŸ’”","ðŸ’•","ðŸ’–","ðŸ’—","ðŸ’™","ðŸ’š","ðŸ’›","ðŸ’œ","ðŸ’","ðŸ’ž","ðŸ’Ÿ","ðŸ’Œ","ðŸ’¤","ðŸ’¢","ðŸ’£","ðŸ’¥","ðŸ’¦","ðŸ’¨","ðŸ’«","ðŸ’¬","ðŸ’­","ðŸ‘“","ðŸ‘”","ðŸ‘•","ðŸ‘–","ðŸ‘—","ðŸ‘˜","ðŸ‘™","ðŸ‘š","ðŸ‘›","ðŸ‘œ","ðŸ‘","ðŸŽ’","ðŸ‘ž","ðŸ‘Ÿ","ðŸ‘ ","ðŸ‘¡","ðŸ‘¢","ðŸ‘‘","ðŸ‘’","ðŸŽ©","ðŸŽ“","ðŸ’„","ðŸ’","ðŸ’Ž","ðŸµ","ðŸ’","ðŸ¶","ðŸ•","ðŸ©","ðŸº","ðŸ±","ðŸˆ","ðŸ¯","ðŸ…","ðŸ†","ðŸ´","ðŸŽ","ðŸ®","ðŸ‚","ðŸƒ","ðŸ„","ðŸ·","ðŸ–","ðŸ—","ðŸ½","ðŸ","ðŸ‘","ðŸ","ðŸª","ðŸ«","ðŸ˜","ðŸ­","ðŸ","ðŸ€","ðŸ¹","ðŸ°","ðŸ‡","ðŸ»","ðŸ¨","ðŸ¼","ðŸ¾","ðŸ”","ðŸ“","ðŸ£","ðŸ¤","ðŸ¥","ðŸ¦","ðŸ§","ðŸ¸","ðŸŠ","ðŸ¢","ðŸ","ðŸ²","ðŸ‰","ðŸ³","ðŸ‹","ðŸ¬","ðŸŸ","ðŸ ","ðŸ¡","ðŸ™","ðŸš","ðŸŒ","ðŸ›","ðŸœ","ðŸ","ðŸž","ðŸ’","ðŸŒ¸","ðŸ’®","ðŸŒ¹","ðŸŒº","ðŸŒ»","ðŸŒ¼","ðŸŒ·","ðŸŒ±","ðŸŒ²","ðŸŒ³","ðŸŒ´","ðŸŒµ","ðŸŒ¾","ðŸŒ¿","ðŸ€","ðŸ","ðŸ‚","ðŸƒ","ðŸ‡","ðŸˆ","ðŸ‰","ðŸŠ","ðŸ‹","ðŸŒ","ðŸ","ðŸŽ","ðŸ","ðŸ","ðŸ‘","ðŸ’","ðŸ“","ðŸ…","ðŸ†","ðŸŒ½","ðŸ„","ðŸŒ°","ðŸž","ðŸ–","ðŸ—","ðŸ”","ðŸŸ","ðŸ•","ðŸ³","ðŸ²","ðŸ±","ðŸ˜","ðŸ™","ðŸš","ðŸ›","ðŸœ","ðŸ","ðŸ ","ðŸ¢","ðŸ£","ðŸ¤","ðŸ¥","ðŸ¡","ðŸ¦","ðŸ§","ðŸ¨","ðŸ©","ðŸª","ðŸŽ‚","ðŸ°","ðŸ«","ðŸ¬","ðŸ­","ðŸ®","ðŸ¯","ðŸ¼","ðŸµ","ðŸ¶","ðŸ·","ðŸ¸","ðŸ¹","ðŸº","ðŸ»","ðŸ´","ðŸ”ª","ðŸŒ","ðŸŒŽ","ðŸŒ","ðŸŒ","ðŸ—¾","ðŸŒ‹","ðŸ—»","ðŸ ","ðŸ¡","ðŸ¢","ðŸ£","ðŸ¤","ðŸ¥","ðŸ¦","ðŸ¨","ðŸ©","ðŸª","ðŸ«","ðŸ¬","ðŸ­","ðŸ¯","ðŸ°","ðŸ’’","ðŸ—¼","ðŸ—½","ðŸŒ","ðŸŒƒ","ðŸŒ„","ðŸŒ…","ðŸŒ†","ðŸŒ‡","ðŸŒ‰","ðŸŒŒ","ðŸŽ ","ðŸŽ¡","ðŸŽ¢","ðŸ’ˆ ","ðŸŽª","ðŸš‚","ðŸšƒ","ðŸš„","ðŸš…","ðŸš†","ðŸš‡","ðŸšˆ","ðŸš‰","ðŸšŠ","ðŸš","ðŸšž","ðŸš‹","ðŸšŒ","ðŸš","ðŸšŽ","ðŸš","ðŸš‘","ðŸš’","ðŸš“","ðŸš”","ðŸš•","ðŸš–","ðŸš—","ðŸš˜","ðŸš™","ðŸšš","ðŸš›","ðŸšœ","ðŸš²","ðŸš","ðŸš¨","ðŸš¥","ðŸš¦ ","ðŸš§","ðŸš¤","ðŸš¢","ðŸ’º","ðŸš","ðŸšŸ","ðŸš ","ðŸš¡","ðŸš€","â³","â°","â±","â²","ðŸ•›","ðŸ•§","ðŸ•","ðŸ•œ","ðŸ•‘","ðŸ•","ðŸ•’","ðŸ•ž","ðŸ•“","ðŸ•Ÿ","ðŸ•”","ðŸ• ","ðŸ••","ðŸ•¡","ðŸ•–","ðŸ•¢","ðŸ•—","ðŸ•£","ðŸ•˜","ðŸ•¤","ðŸ•™","ðŸ•¥","ðŸ•š","ðŸ•¦","ðŸŒ‘","ðŸŒ’","ðŸŒ“","ðŸŒ”","ðŸŒ•","ðŸŒ–","ðŸŒ—","ðŸŒ˜","ðŸŒ™","ðŸŒš","ðŸŒ›","ðŸŒœ","ðŸŒ","ðŸŒž","ðŸŒŸ","ðŸŒ ","ðŸŒ€","ðŸŒˆ","ðŸŒ‚","ðŸ”¥","ðŸ’§","ðŸŒŠ","ðŸŽƒ","ðŸŽ„","ðŸŽ†","ðŸŽ‡","âœ¨","ðŸŽˆ","ðŸŽ‰","ðŸŽŠ","ðŸŽ‹","ðŸŽ","ðŸŽŽ","ðŸŽ","ðŸŽ","ðŸŽ‘","ðŸŽ€","ðŸŽ","ðŸŽ«","ðŸ†","ðŸ€","ðŸˆ","ðŸ‰","ðŸŽ¾","ðŸŽ³","ðŸŽ£","ðŸŽ½","ðŸŽ¿","ðŸŽ¯","ðŸŽ±","ðŸ”®","ðŸŽ®","ðŸŽ°","ðŸŽ²","ðŸƒ","ðŸŽ´","ðŸŽ­","ðŸŽ¨","ðŸ”‡","ðŸ”ˆ ","ðŸ”‰","ðŸ”Š","ðŸ“¢","ðŸ“£","ðŸ“¯","ðŸ””","ðŸ”•","ðŸŽ¼","ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸ“»","ðŸŽ·","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ“±","ðŸ“²","ðŸ“ž","ðŸ“Ÿ","ðŸ“ ","ðŸ”‹","ðŸ”Œ","ðŸ’»","ðŸ’½","ðŸ’¾","ðŸ’¿","ðŸ“€","ðŸŽ¥","ðŸŽ¬","ðŸ“º","ðŸ“·","ðŸ“¹","ðŸ“¼","ðŸ”","ðŸ”Ž","ðŸ’¡","ðŸ”¦","ðŸ®","ðŸ“”","ðŸ“•","ðŸ“–","ðŸ“—","ðŸ“˜","ðŸ“™","ðŸ“š","ðŸ““","ðŸ“’","ðŸ“ƒ","ðŸ“œ","ðŸ“„","ðŸ“°","ðŸ“‘","ðŸ”–","ðŸ’°","ðŸ’´","ðŸ’µ","ðŸ’¶","ðŸ’·","ðŸ’¸","ðŸ’³","ðŸ’¹","ðŸ’±","ðŸ’²","ðŸ“§","ðŸ“¨","ðŸ“©","ðŸ“¤","ðŸ“¥","ðŸ“¦","ðŸ“«","ðŸ“ª","ðŸ“¬","ðŸ“­","ðŸ“®","ðŸ“","ðŸ’¼","ðŸ“","ðŸ“‚","ðŸ“…","ðŸ“†","ðŸ“‡","ðŸ“ˆ","ðŸ“‰","ðŸ“Š","ðŸ“‹","ðŸ“Œ","ðŸ“","ðŸ“Ž","ðŸ“","ðŸ“","ðŸ”’","ðŸ”“","ðŸ”","ðŸ”","ðŸ”‘","ðŸ”¨","ðŸ”«","ðŸ”§","ðŸ”©","ðŸ”—","ðŸ”¬","ðŸ”­","ðŸ“¡","ðŸ’‰","ðŸ’Š","ðŸšª ","ðŸš½","ðŸš¿","ðŸ›","ðŸš¬","ðŸ—¿","ðŸ§","ðŸš®","ðŸš°","ðŸš¹","ðŸšº","ðŸš»","ðŸš¼","ðŸš¾","ðŸ›‚","ðŸ›ƒ","ðŸ›„","ðŸ›…","ðŸš¸","ðŸš«","ðŸš³","ðŸš­","ðŸš¯","ðŸš±","ðŸš·","ðŸ“µ","ðŸ”ž","ðŸ”ƒ","ðŸ”„","ðŸ”™","ðŸ”š","ðŸ”›","ðŸ”œ","ðŸ”","ðŸ”¯","â›Ž","ðŸ”€","ðŸ”","ðŸ”‚","â©","â­","â¯","âª","â®","ðŸ”¼","â«","ðŸ”½","â¬","ðŸŽ¦","ðŸ”…","ðŸ”†","ðŸ“¶","ðŸ“³","ðŸ“´","ðŸ”±","ðŸ“›","ðŸ”°","âœ…","âŒ","âŽ","âž•","âž–","âž—","âž°","âž¿","â“","â”","â•","ðŸ”Ÿ","ðŸ’¯","ðŸ” ","ðŸ”¡","ðŸ”¢","ðŸ”£","ðŸ”¤","ðŸ…°","ðŸ†Ž","ðŸ…±","ðŸ†‘","ðŸ†’","ðŸ†“","ðŸ†”","ðŸ†•","ðŸ†–","ðŸ…¾","ðŸ†—","ðŸ†˜","ðŸ†™","ðŸ†š","ðŸˆ","ðŸˆ‚","ðŸˆ·","ðŸˆ¶","ðŸ‰","ðŸˆ¹","ðŸˆ²","ðŸ‰‘","ðŸˆ¸","ðŸˆ´","ðŸˆ³","ðŸˆº","ðŸˆµ","ðŸ”¶","ðŸ”·","ðŸ”¸","ðŸ”¹","ðŸ”º","ðŸ”»","ðŸ’ ","ðŸ”˜","ðŸ”²","ðŸ”³","ðŸ”´","ðŸ”µ","ðŸ","ðŸš©","ðŸŽŒ"];
// const SYMBOLS = "ðŸ˜€ðŸŽ‰ðŸ’–ðŸŽ©ðŸ¶ðŸ±ðŸ¦„ðŸ¬ðŸŒðŸŒ›ðŸŒžðŸ’«ðŸŽðŸŒðŸ“ðŸðŸŸðŸ¿";

class App extends Component {
  state = {
    cards: this.generateCards(),
    currentPair: [],
    guesses: 0,
    matchedCardIndices: []
  };

  newGame = ()=> {    
    this.setState({  cards: this.generateCards(),
      currentPair: [],
      guesses: 0,
      matchedCardIndices: [] });
  }

  generateCards() {
    const result = [];
    const size = SIDE * SIDE;

    var randomIndices = [];
    var symbols18 = "";

    var searchSymbol = true;
    while (searchSymbol) {
      var random = Math.floor(Math.random() * Math.floor(717));
      if (!randomIndices.includes(random)) {
        randomIndices.push(random);
        symbols18 = symbols18.concat(SYMBOLS[random]);
        // console.log(random, ' = ', SYMBOLS[random],'/' ,SYMBOLS.length);
      }

      if (symbols18.length >= 36) {
        searchSymbol = false;
      }
    }

    // const candidates = shuffle(SYMBOLS);
    const candidates = shuffle(symbols18);
    while (result.length < size) {
      const card = candidates.pop();
      result.push(card, card);
    }
    return shuffle(result);
  }

  handleCardClick = index => {
    const { currentPair } = this.state;

    if (currentPair.length === 2) {
      return;
    }

    if (currentPair.length === 0) {
      this.setState({ currentPair: [index] });
      return;
    }

    this.handleNewPairClosedBy(index);
  };

  getFeedbackForCard(index) {
    const { currentPair, matchedCardIndices } = this.state;
    const indexMatched = matchedCardIndices.includes(index);

    if (currentPair.length < 2) {
      return indexMatched || index === currentPair[0] ? "visible" : "hidden";
    }

    if (currentPair.includes(index)) {
      return indexMatched ? "justMatched" : "justMismatched";
    }

    return indexMatched ? "visible" : "hidden";
  }

  handleNewPairClosedBy(index) {
    const { cards, currentPair, guesses, matchedCardIndices } = this.state;

    const newPair = [currentPair[0], index];
    const newGuesses = guesses + 1;
    const matched = cards[newPair[0]] === cards[newPair[1]];

    this.setState({ currentPair: newPair, guesses: newGuesses });
    if (matched) {
      this.setState({
        matchedCardIndices: [...matchedCardIndices, ...newPair]
      });
    }
    setTimeout(() => this.setState({ currentPair: [] }), VIUAL_PAUSE_MSEC);
  }

  render() {
    const { cards, guesses, matchedCardIndices } = this.state;
    const won = matchedCardIndices.length === cards.length;
    return (
        <div className="memory">
          <h1>Memory Game</h1>
          <GuessCount guesses={guesses} />
          {cards.map((card, index) => (
            <Card
              card={card}
              key={index}
              index={index}
              feedback={this.getFeedbackForCard(index)}
              onClick={this.handleCardClick}
            />
          ))}
          
          {won && <HallOfFame entries={FAKE_HOF} />}
          {won && <button onClick={this.newGame}>New game</button>}
        </div>
    );
  }
}

export default App;
